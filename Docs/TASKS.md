# TASKS (Big-Bang Rewrite)

| TASK-ID | Priority | Status | Description | Done Criteria | Evidence |
|---|---|---|---|---|---|
| BB-001 | P0 | DONE | 빅뱅 재작성 baseline 고정(테스트/품질/문서 상태 스냅샷) | baseline 명령 세트가 모두 실행되고 결과가 저장됨 | `cargo test --workspace` pass, `cargo clippy --workspace --all-targets -- -D warnings` pass, `bash scripts/release_preflight.sh` pass |
| BB-002 | P0 | DONE | 공개 API/문서 계약 snapshot 생성 | 재작성 전 public API 목록과 문서 계약이 스냅샷으로 고정됨 | `README.md`, `Docs/CORE_API.md`, `crates/coclai/src/lib.rs` |
| BB-003 | P1 | DONE | schema/manifest/doc-sync 상태 동결 | drift/manifest/doc-sync 체크가 전부 pass | `bash scripts/check_schema_manifest.sh` pass, `COCLAI_SCHEMA_DRIFT_MODE=hard COCLAI_SCHEMA_DRIFT_SOURCE=codex bash scripts/check_schema_drift.sh` pass, `COCLAI_DOC_SYNC_MODE=hard COCLAI_DOC_SYNC_FAIL_ON_MISMATCH=1 bash scripts/check_doc_contract_sync.sh` pass |
| BB-004 | P0 | DONE | Big-Bang 타깃 구조 명세 고정(runtime/web/artifact 파일 경계) | 각 crate의 타깃 모듈 트리와 의존 규칙이 문서화됨 | `Docs/IMPLEMENTATION-PLAN.md`의 `Target File Cut Map` 섹션 |
| BB-005 | P1 | DONE | 공개 API 호환 정책 고정(금지/허용 변경 범위) | 재작성 중 허용되는 내부 변경과 금지 breaking change가 명시됨 | `Docs/IMPLEMENTATION-PLAN.md`의 `Constraints` 섹션 |
| BB-006 | P1 | DONE | 컷오버 정책/롤백 절차 문서화 | 컷오버 중단 조건과 롤백 절차가 체크리스트로 존재 | `Docs/IMPLEMENTATION-PLAN.md`의 `Risk/Rollback` 섹션, `Docs/CUTOVER-OPERATIONS.md` |
| BB-007 | P0 | DONE | Runtime 재작성 1: runtime core/spawn/dispatch 경계 재편 | `coclai_runtime` 컴파일+핵심 테스트 통과, 역의존 0 | `cargo test -p coclai_runtime --lib --tests` pass (138/138), `rg -n "coclai_web|coclai_artifact" crates/coclai_runtime/src` => none |
| BB-008 | P1 | DONE | Runtime 재작성 2: API 흐름(thread/turn/prompt) 재편 | contract deterministic + classify fixtures 통과 | `cargo test -p coclai_runtime --test contract_deterministic` pass (3/3), `cargo test -p coclai_runtime --test classify_fixtures` pass (4/4) |
| BB-009 | P1 | DONE | Runtime 재작성 3: state reducer/pruning 재편 | `state` 관련 단위/통합 테스트 통과 + projection 동등성 확인 | `cargo test -p coclai_runtime --lib --tests` pass, `state::tests::*` + `runtime::tests::state_snapshot_*` pass |
| BB-010 | P0 | DONE | Web 재작성: session/turn/approval 서비스 경계 분리 | tenant/session ownership 회귀 0 | `cargo test -p coclai_web --lib` pass (13/13), `crates/coclai_web/src/{session_service.rs,turn_service.rs,approval_service.rs}` |
| BB-011 | P1 | DONE | Web 이벤트 라우팅/SSE 경로 정합성 보강 | subscribe/post approval 관련 회귀 테스트 통과 | `cargo test -p coclai_web --lib` pass (13/13), `crates/coclai_web/src/subscription_service.rs` |
| BB-012 | P0 | DONE | Artifact 재작성: manager/orchestrator/store 경계 분리 | DocGenerate/DocEdit/conflict/lock/revision 회귀 0 | `cargo test -p coclai_artifact --lib` pass (26/26), `crates/coclai_artifact/src/orchestrator.rs` |
| BB-013 | P0 | DONE | Facade 재결선: `coclai` 공개 진입점 재바인딩 | `quick_run`/`Workflow`/`AppServer` 시그니처/동작 불변 + 런타임 진입점 정상 동작 | `cargo test -p coclai --lib --tests` pass (17/17), `crates/coclai/src/lib.rs` |
| BB-014 | P1 | DONE | 예제/문서/계약 동기화 | README/CORE_API/SCHEMA 계약 문서 mismatch 0 | `COCLAI_DOC_SYNC_MODE=hard COCLAI_DOC_SYNC_FAIL_ON_MISMATCH=1 bash scripts/check_doc_contract_sync.sh` -> mismatch 0 |
| BB-015 | P0 | DONE | 빅뱅 통합 검증 1: workspace test + clippy | workspace 테스트/정적 점검 전부 green | `cargo test --workspace` pass, `cargo clippy --workspace --all-targets -- -D warnings` pass |
| BB-016 | P1 | DONE | 빅뱅 통합 검증 2: micro bench + nightly gate | 성능 회귀 임계치 통과 + nightly opt-in 통과 | `bash scripts/run_micro_bench.sh` pass (`max-regression=15%` 이내), `bash scripts/run_nightly_opt_in_gate.sh` pass |
| BB-017 | P0 | DONE | 최종 preflight + 컷오버 리허설 | `release_preflight.sh` pass + 컷오버 체크리스트 complete | `bash scripts/release_preflight.sh` pass, `Docs/CUTOVER-OPERATIONS.md`의 rehearsal checklist |
| BB-018 | P0 | DONE | 컷오버 실행/사후 안정화 모니터링 계획 확정 | 롤백 트리거/SLO/알림 담당자/관측 지표가 문서에 완전 기재됨 | `Docs/CUTOVER-OPERATIONS.md` (rollback trigger, SLO, alert owner, monitoring matrix) |
| BB-019 | P0 | DONE | 미구현/임시코드 차단 게이트 고정 | 코드 영역(`crates/**`)에서 `TODO|todo!|unimplemented!` 탐지 결과가 컷오버 허용 기준(0건) 충족 | `rg -n "todo!\\(|unimplemented!\\(" crates` -> 0, `rg -n "TODO" crates --glob '!**/tests/fixtures/**'` -> 0 |
| BB-020 | P0 | DONE | 문서-코드-계약 정합성 최종 감사 | ARCHITECTURE/CORE_API/SCHEMA/README와 코드 참조가 상호 일치 | `COCLAI_DOC_SYNC_MODE=hard COCLAI_DOC_SYNC_FAIL_ON_MISMATCH=1 bash scripts/check_doc_contract_sync.sh` (`coverage=78/78`, `mismatch=0`) |
| BB-021 | P0 | DONE | CI 워크플로우 정합성 고정: scope에 선언된 `.github/workflows/ci.yml` 게이트 경로 검증 | CI 워크플로우에 품질/계약 게이트 단계가 존재하고 계획 문서와 불일치 0 | `rg -n \"check_product_hygiene.sh|check_doc_contract_sync.sh|check_schema_drift.sh\" .github/workflows/ci.yml` -> lines `29,32,35` |
| BB-022 | P1 | DONE | CI schema drift 소스 기준 상향(`active` -> `codex` 기본) | PR 단계 drift 게이트가 업스트림 SoT(codex) 기준으로 실행됨 | `.github/workflows/ci.yml:35` (`COCLAI_SCHEMA_DRIFT_SOURCE=${COCLAI_CI_SCHEMA_DRIFT_SOURCE:-codex}`), `bash scripts/release_preflight.sh` pass (`schema-drift OK (mode=hard, source=codex)`) |
| BB-023 | P2 | DONE | 구현 완료된 분석/레거시 문서 정리 | 실행에 사용되지 않는 구 분석 문서 제거 + 참조 무결성 유지 | 삭제: `Docs/analysis/{NEXT-ACTIONS.md,FINAL-ANALYSIS-REPORT.md,EVIDENCE-MAP.md,BIGBANG-BASELINE-SNAPSHOT-2026-02-28.md,BIGBANG-FILE-AUDIT-2026-02-28.md}`, `rg -n "NEXT-ACTIONS\\.md|FINAL-ANALYSIS-REPORT\\.md|EVIDENCE-MAP\\.md|BIGBANG-BASELINE-SNAPSHOT-2026-02-28\\.md|BIGBANG-FILE-AUDIT-2026-02-28\\.md" README.md Docs .github scripts crates -g '!Docs/TASKS.md'` -> 0 |
| BB-024 | P1 | DONE | Option 2 리팩토링 1: 프로덕션 파일 inline tests를 모듈 파일로 분리 | 대상 파일의 `#[cfg(test)] mod tests { ... }`가 `#[cfg(test)] mod tests;` + `*/tests.rs` 구조로 전환되고 테스트 동작 동일 | 생성: `crates/coclai/src/{appserver/tests.rs,ergonomic/tests.rs}`, `crates/coclai_plugin_core/src/tests.rs`, `crates/coclai_runtime/src/{rpc_contract/tests.rs,schema/tests.rs,sink/tests.rs,state/tests.rs,transport/tests.rs}`; `cargo test --workspace` pass; `bash scripts/release_preflight.sh` pass |
| BB-025 | P1 | DONE | Option 2 리팩토링 2: `coclai_runtime/src/api.rs` 추가 분해(행동 불변) | `api.rs` LOC 감소 + 공개 API 시그니처 diff 0 + runtime contract tests pass | 추가 분해: `crates/coclai_runtime/src/api/types.rs` 생성 + `api.rs` `1340 -> 794` LOC; `cargo test -p coclai_runtime --lib --tests` pass; `cargo test --workspace` pass; `bash scripts/release_preflight.sh` pass |
| BB-026 | P1 | DONE | Option 2 리팩토링 3: web/artifact lib 파사드 슬림화 | `lib.rs`는 파사드 중심, 서비스/오케스트레이션 구현은 하위 모듈 유지, 테스트 green | 분리: `crates/coclai_web/src/types.rs`, `crates/coclai_artifact/src/types.rs`; LOC: `coclai_web/src/lib.rs` `310 -> 224`, `coclai_artifact/src/lib.rs` `325 -> 137`; `cargo test -p coclai_web --lib` pass; `cargo test -p coclai_artifact --lib` pass; `cargo test --workspace` pass; `bash scripts/release_preflight.sh` pass |
| BB-027 | P1 | DONE | 릴리즈 프리플라이트 프로파일 정합성: strict 모드에서 micro-bench/nightly 게이트를 옵션 실행 | 기본 preflight 동작은 유지하면서 strict env 설정 시 perf/nightly 게이트가 실행되고 실패를 전파 | `bash scripts/release_preflight.sh` pass, `COCLAI_RELEASE_INCLUDE_PERF=1 COCLAI_RELEASE_INCLUDE_NIGHTLY=1 bash scripts/release_preflight.sh` pass |
| BB-028 | P1 | DONE | 문서-계약 sync 증거 검증 강화: evidence 파일 참조 검증 + opt-in 라인 범위 상한 검증 | 기본 hard 모드에서 evidence 경로 유효성 검증을 수행하고, `COCLAI_DOC_SYNC_VALIDATE_LINE_RANGES=1`에서 stale 라인 참조를 결정적으로 실패시킴 | `COCLAI_DOC_SYNC_MODE=hard COCLAI_DOC_SYNC_FAIL_ON_MISMATCH=1 bash scripts/check_doc_contract_sync.sh` pass (`checked=151 invalid=0`), `COCLAI_DOC_SYNC_MODE=hard COCLAI_DOC_SYNC_FAIL_ON_MISMATCH=1 COCLAI_DOC_SYNC_VALIDATE_LINE_RANGES=1 bash scripts/check_doc_contract_sync.sh` fail (`invalid=47`) |
| BB-029 | P2 | DONE | runtime state reducer 핫스팟 분해(행동 불변) | `reduce_in_place_with_limits`를 이벤트별 헬퍼로 분해하고 `coclai_runtime`/preflight 테스트 결과 불변 | `crates/coclai_runtime/src/state.rs` helper 분해(`handle_turn_*`, `handle_item_*`), `cargo test -p coclai_runtime --lib --tests` pass, `bash scripts/release_preflight.sh` pass |
| BB-030 | P1 | DONE | coclai_runtime 대형 테스트 파일 추가 분할(`api/tests.rs`, `runtime/tests.rs`) | 공통 헬퍼는 유지하고 테스트 시나리오를 하위 모듈로 분리, 동작/회귀 불변 | 분리: `crates/coclai_runtime/src/api/tests/{params_and_types.rs,thread_api.rs,run_prompt.rs}`, `crates/coclai_runtime/src/runtime/tests/{core_lifecycle.rs,server_requests.rs,state_and_schema.rs}`; `cargo test -p coclai_runtime --lib --tests` pass (138/138) |
| BB-031 | P0 | DONE | release preflight에 실서버 contract gate 강제(`contract_real_cli`) | preflight가 env 누락으로 실서버 계약 테스트를 스킵하지 않고 반드시 실행/실패를 반영 | 코드: `scripts/release_preflight.sh`에 `APP_SERVER_CONTRACT=1 ... cargo test -p coclai_runtime --test contract_real_cli` 추가, 검증: `APP_SERVER_CONTRACT=1 APP_SERVER_BIN=\"${COCLAI_RELEASE_APP_SERVER_BIN:-codex}\" cargo test -p coclai_runtime --test contract_real_cli` pass (4/4) |
| BB-032 | P1 | DONE | 거대 오브젝트 분해: `runtime/dispatch` 서버요청 payload 검증 분해(행동 불변) | 메서드별 검증 함수를 분리해 책임 경계를 명확히 하고 기존 에러 문자열/동작 유지 | `crates/coclai_runtime/src/runtime/dispatch.rs`에 `validate_*_payload` 함수로 분해 + 공통 `require_object` 도입, `cargo check -p coclai_runtime` pass |
| BB-033 | P0 | BLOCKED | CI 워크플로우에 실서버 contract gate 추가(`contract_real_cli`) | CI checks job에서 `APP_SERVER_CONTRACT=1`로 `coclai_runtime` 실서버 계약 테스트를 별도 게이트로 실행하고 실패를 전파 | 사용자 정책으로 미적용: \"GitHub 러너/액션 등록하지 말 것\". 실서버 계약 검증은 로컬 `release_preflight.sh`/수동 실행으로 유지 |
| BB-034 | P1 | DONE | 거대 오브젝트 분해: `coclai_runtime/src/api.rs` 책임 분리 2차(`thread_api`, `prompt_run`) | `api.rs`를 파사드 수준으로 축소하고 thread/prompt 실행 경계를 별도 모듈로 이동, 동작/회귀 불변 | 분리: `crates/coclai_runtime/src/api/{thread_api.rs,prompt_run.rs}` 추가 + `api.rs` `794 -> 48` LOC, `cargo check -p coclai_runtime` pass, `cargo test -p coclai_runtime --lib --tests` pass (138/138) |
| BB-035 | P0 | DONE | 출시 게이트 안정화: `release_preflight.sh` 실서버 통합 테스트 flaky 차단 해소 | preflight를 연속 실행해도 `coclai` 실서버 테스트(`quick_run`, `workflow_run`)가 네트워크 일시 오류로 실패하지 않고 안정적으로 통과 | 개선: `scripts/release_preflight.sh`에서 일반 workspace 테스트와 `coclai real-server` 테스트를 분리하고(`--skip ergonomic::tests::real_server::*`) 실서버 테스트 재시도 게이트(`COCLAI_RELEASE_REAL_SERVER_RETRIES`, `COCLAI_RELEASE_REAL_SERVER_BACKOFF_SEC`) 및 테스트별 재시도 실행 도입; 검증: (escalated) `cargo test -p coclai ergonomic::tests::real_server::quick_run_executes_prompt_against_real_codex_server -- --nocapture` pass, `(escalated) cargo test -p coclai ergonomic::tests::real_server::workflow_run_executes_prompt_against_real_codex_server -- --nocapture` pass, `(escalated) COCLAI_RELEASE_REAL_SERVER_RETRIES=1 COCLAI_RELEASE_REAL_SERVER_BACKOFF_SEC=1 bash scripts/release_preflight.sh` pass |
| BB-036 | P1 | DONE | 테스트 코드 분리: `coclai ergonomic` 테스트를 성격별 모듈로 분해 | 단일 `ergonomic/tests.rs`를 공통/유닛/실서버 모듈로 분리하고 기존 테스트 명세를 유지 | 분리: `crates/coclai/src/ergonomic/tests/{mod.rs,common.rs,unit.rs,real_server.rs}` + 기존 `ergonomic/tests.rs` 제거, `cargo test -p coclai --lib --tests -- --skip ergonomic::tests::real_server::quick_run_executes_prompt_against_real_codex_server --skip ergonomic::tests::real_server::workflow_run_executes_prompt_against_real_codex_server` pass (14/14) |
| BB-037 | P1 | BLOCKED | CI 게이트 정렬: 실서버 테스트를 workspace 테스트와 분리하고 재시도 정책을 CI에 고정 | CI에서 `coclai` real-server 테스트 2건을 일반 workspace 테스트에서 제외하고, 별도 재시도 게이트로 실행 | 사용자 정책으로 미적용: \"GitHub 러너/액션 등록하지 말 것\". 배포 검증은 로컬 `release_preflight.sh` 기준으로 수행 |
| BB-038 | P2 | DONE | 릴리즈 문서 정합화: preflight 실서버 재시도 정책 문서 반영 | README/Cutover 문서가 현재 `release_preflight.sh` 게이트 정책(실서버 분리+재시도, env 제어)을 정확히 설명 | `README.md`의 `검증 및 릴리즈 게이트`/`Rollout Plan` 갱신(`COCLAI_RELEASE_REAL_SERVER_RETRIES`, `COCLAI_RELEASE_REAL_SERVER_BACKOFF_SEC`), `Docs/CUTOVER-OPERATIONS.md` precondition 참고사항 추가, `COCLAI_DOC_SYNC_MODE=hard COCLAI_DOC_SYNC_FAIL_ON_MISMATCH=1 bash scripts/check_doc_contract_sync.sh` pass |
